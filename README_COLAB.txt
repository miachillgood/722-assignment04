=============================================================================
INFOSYS 722 - Iteration 4: Fraud Detection (BDAS Solution)
Google Colab è¿è¡ŒæŒ‡å—
=============================================================================

å­¦ç”Ÿå§“å: Xiaoqing Miao
å­¦å·: xmia665@aucklanduni.ac.nz
æäº¤æ—¥æœŸ: 2025-10-15

=============================================================================
å¿«é€Ÿå¼€å§‹ (3 æ­¥)
=============================================================================

æ­¥éª¤ 1: è§£å‹æ–‡ä»¶
  - è§£å‹ zip æ–‡ä»¶åˆ°æœ¬åœ°æ–‡ä»¶å¤¹
  - åº”åŒ…å«ä»¥ä¸‹æ–‡ä»¶:
    âœ“ fraud_detection_colab.py
    âœ“ Financial Fraud-Rawdata.csv
    âœ“ README_COLAB.txt (æœ¬æ–‡ä»¶)

æ­¥éª¤ 2: ä¸Šä¼ åˆ° Google Colab
  1. è®¿é—® https://colab.research.google.com/
  2. åˆ›å»ºæ–°ç¬”è®°æœ¬æˆ–æ‰“å¼€ç°æœ‰ç¬”è®°æœ¬
  3. ç‚¹å‡»å·¦ä¾§æ–‡ä»¶å¤¹å›¾æ ‡ ğŸ“
  4. ç‚¹å‡»ä¸Šä¼ æŒ‰é’®
  5. ä¸Šä¼  fraud_detection_colab.py
  6. ä¸Šä¼  Financial Fraud-Rawdata.csv (çº¦éœ€ 5-10 åˆ†é’Ÿ)

æ­¥éª¤ 3: è¿è¡Œè„šæœ¬
  åœ¨ Colab çš„ä»£ç å•å…ƒæ ¼ä¸­è¾“å…¥å¹¶è¿è¡Œ:
  
    !python fraud_detection_colab.py
  
  æˆ–è€…:
  
    %run fraud_detection_colab.py

=============================================================================
è‡ªåŠ¨åŒ–åŠŸèƒ½è¯´æ˜
=============================================================================

è„šæœ¬ä¼šè‡ªåŠ¨æ‰§è¡Œä»¥ä¸‹æ“ä½œ:

1. ç¯å¢ƒé…ç½® (è‡ªåŠ¨)
   âœ“ æ£€æµ‹ Colab ç¯å¢ƒ
   âœ“ å®‰è£… Java 11 (Spark ä¾èµ–)
   âœ“ å®‰è£… PySpark
   âœ“ éªŒè¯å®‰è£…

2. æ•°æ®å¤„ç† (è‡ªåŠ¨)
   âœ“ å¦‚æœæ•°æ®æ–‡ä»¶æœªæ‰¾åˆ°ï¼Œä¼šå¼¹å‡ºä¸Šä¼ å¯¹è¯æ¡†
   âœ“ åŠ è½½ 6.36M æ¡äº¤æ˜“è®°å½•
   âœ“ æ•°æ®è´¨é‡æ£€æŸ¥
   âœ“ ç‰¹å¾å·¥ç¨‹ (è¿‡æ»¤ã€ç¼–ç ã€log1p è½¬æ¢)

3. æ¨¡å‹è®­ç»ƒ (è‡ªåŠ¨)
   âœ“ 70/15/15 æ•°æ®åˆ†å‰²
   âœ“ ç±»åˆ«åŠ æƒå¤„ç†ä¸å¹³è¡¡
   âœ“ Pipeline è®­ç»ƒ (Assembler â†’ Scaler â†’ LogisticRegression)
   âœ“ ä¿å­˜æ¨¡å‹

4. é˜ˆå€¼ä¼˜åŒ– (è‡ªåŠ¨)
   âœ“ åœ¨éªŒè¯é›†ä¸Šæ‰«æ 99 ä¸ªé˜ˆå€¼ç‚¹
   âœ“ ä½¿ç”¨ä¸šåŠ¡æˆæœ¬å‡½æ•° (FP:FN = 1:25)
   âœ“ æ‰¾åˆ°æœ€ä¼˜é˜ˆå€¼ Ï„*

5. æµ‹è¯•è¯„ä¼° (è‡ªåŠ¨)
   âœ“ åœ¨æµ‹è¯•é›†ä¸Šåº”ç”¨ Ï„*
   âœ“ è®¡ç®— ROC-AUC, PR-AUC, Precision, Recall, F1
   âœ“ ç”Ÿæˆ ROC å’Œ PR æ›²çº¿æ•°æ®

=============================================================================
é¢„æœŸæ‰§è¡Œæ—¶é—´
=============================================================================

é˜¶æ®µ                          æ—¶é—´
--------------------------------------------
ç¯å¢ƒè®¾ç½® (è‡ªåŠ¨)              1-2 åˆ†é’Ÿ
æ•°æ®ä¸Šä¼  (å¦‚éœ€è¦)            5-10 åˆ†é’Ÿ  
æ•°æ®åŠ è½½ä¸è´¨é‡æ£€æŸ¥           1-2 åˆ†é’Ÿ
ç‰¹å¾å·¥ç¨‹                     1 åˆ†é’Ÿ
æ¨¡å‹è®­ç»ƒ                     2-3 åˆ†é’Ÿ
é˜ˆå€¼ä¼˜åŒ–                     1-2 åˆ†é’Ÿ
æµ‹è¯•é›†è¯„ä¼°                   1 åˆ†é’Ÿ
--------------------------------------------
æ€»è®¡                         15-25 åˆ†é’Ÿ

=============================================================================
é¢„æœŸè¾“å‡ºæ–‡ä»¶
=============================================================================

æ‰§è¡Œå®Œæˆåä¼šåœ¨ Colab æ–‡ä»¶ç³»ç»Ÿä¸­ç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶å¤¹:

1. outputs/ ç›®å½• (ç»“æœæ–‡ä»¶)
   â”œâ”€â”€ metrics_test_at_tau.json      æµ‹è¯•é›†æ€§èƒ½æŒ‡æ ‡
   â”œâ”€â”€ tau_star.json                 æœ€ä¼˜é˜ˆå€¼ä¿¡æ¯
   â”œâ”€â”€ lr_coefficients.csv           æ¨¡å‹ç³»æ•°
   â”œâ”€â”€ cost_curve.csv                æˆæœ¬æ›²çº¿æ•°æ®
   â”œâ”€â”€ roc_points.csv                ROC æ›²çº¿åæ ‡ç‚¹
   â”œâ”€â”€ pr_points.csv                 PR æ›²çº¿åæ ‡ç‚¹
   â”œâ”€â”€ class_counts_train.csv        è®­ç»ƒé›†ç±»åˆ«åˆ†å¸ƒ
   â”œâ”€â”€ class_counts_validation.csv   éªŒè¯é›†ç±»åˆ«åˆ†å¸ƒ
   â”œâ”€â”€ class_counts_test.csv         æµ‹è¯•é›†ç±»åˆ«åˆ†å¸ƒ
   â”œâ”€â”€ dist_evidence.json            åˆ†å¸ƒå¼æ‰§è¡Œè¯æ®
   â”œâ”€â”€ quality_null_counts.json      ç©ºå€¼ç»Ÿè®¡
   â”œâ”€â”€ quality_duplicates.json       é‡å¤è¡Œç»Ÿè®¡
   â””â”€â”€ schema.txt                    æ•°æ®é›† schema

2. models/ ç›®å½• (è®­ç»ƒæ¨¡å‹)
   â””â”€â”€ bdas_lr_pipeline_YYYYMMDD_HHMMSS/
       â”œâ”€â”€ metadata/                 Pipeline å…ƒæ•°æ®
       â””â”€â”€ stages/                   å„é˜¶æ®µæ¨¡å‹
           â”œâ”€â”€ 0_VectorAssembler_*/
           â”œâ”€â”€ 1_StandardScaler_*/
           â””â”€â”€ 2_LogisticRegression_*/

å¯ä»¥å³é”®ç‚¹å‡»æ–‡ä»¶å¤¹é€‰æ‹© Download ä¸‹è½½æ‰€æœ‰ç»“æœã€‚

=============================================================================
å…³é”®æ€§èƒ½æŒ‡æ ‡ (é¢„æœŸç»“æœ)
=============================================================================

æµ‹è¯•é›†æ€§èƒ½ (é˜ˆå€¼ Ï„* = 0.72):
  ROC-AUC:   0.9613
  PR-AUC:    0.5903
  Precision: 0.3494
  Recall:    0.6196
  F1-Score:  0.4468

æ··æ·†çŸ©é˜µ:
              Predicted
              0        1
  Actual  0   412,658  1,462   (TN, FP)
          1   482      785     (FN, TP)

åˆ†å¸ƒå¼é…ç½®:
  Spark Master:        local[*]
  Default Parallelism: 8
  Driver Memory:       8GB
  Train Partitions:    8

ä¸ Iteration 3 (OSAS) å¯¹æ¯”:
  æŒ‡æ ‡          I3 (OSAS)  I4 (BDAS)  Î” (I4-I3)
  -----------------------------------------------
  ROC-AUC       0.9756     0.9613     -0.0143
  PR-AUC        0.5821     0.5903     +0.0082
  Recall        0.6595     0.6196     -0.0399
  Precision     0.2742     0.3494     +0.0752
  F1-Score      0.3870     0.4468     +0.0598

ç»“è®º: BDAS æ–¹æ¡ˆæˆåŠŸä¿æŒäº†ä¸ OSAS æ–¹æ¡ˆçš„æ€§èƒ½ä¸€è‡´æ€§ï¼Œ
      éªŒè¯äº†æŠ€æœ¯æ ˆè¿ç§»çš„å¯è¡Œæ€§ã€‚

=============================================================================
éªŒè¯æˆåŠŸè¿è¡Œ
=============================================================================

æ‰§è¡Œå®Œæˆåï¼Œç»ˆç«¯åº”æ˜¾ç¤º:

  ============================================================
  TEST SET PERFORMANCE SUMMARY
  ============================================================
  ROC-AUC:    0.9613
  PR-AUC:     0.5903
  Precision:  0.3494
  Recall:     0.6196
  F1-Score:   0.4468
  Confusion Matrix: TP=785, FP=1462, TN=412658, FN=482
  ============================================================
  
  ============================================================
  PIPELINE COMPLETE!
  ============================================================
  
  Outputs saved to: outputs/
  Model saved to: models/bdas_lr_pipeline_YYYYMMDD_HHMMSS
  
  ğŸ“¥ To download results:
  1. Click the folder icon on the left sidebar
  2. Right-click 'outputs' folder â†’ Download
  3. Right-click 'models' folder â†’ Download
  
  âœ“ SparkSession stopped

=============================================================================
æ•…éšœæ’é™¤
=============================================================================

é—®é¢˜ 1: "Data file not found" é”™è¯¯
  åŸå› : æ•°æ®æ–‡ä»¶æœªä¸Šä¼ æˆ–æ–‡ä»¶åä¸åŒ¹é…
  è§£å†³: 
    - ç¡®ä¿æ–‡ä»¶åå®Œå…¨åŒ¹é…: Financial Fraud-Rawdata.csv
    - è„šæœ¬ä¼šè‡ªåŠ¨å¼¹å‡ºä¸Šä¼ å¯¹è¯æ¡†ï¼Œé€‰æ‹©æ­£ç¡®çš„æ–‡ä»¶
    - æˆ–æ‰‹åŠ¨ä¸Šä¼ åˆ° Colab æ ¹ç›®å½•

é—®é¢˜ 2: å†…å­˜ä¸è¶³ (OOM) é”™è¯¯
  åŸå› : Colab å…è´¹ç‰ˆ RAM é™åˆ¶ (çº¦ 12GB)
  è§£å†³: 
    - è„šæœ¬å·²é…ç½® Spark Driver Memory = 8GB
    - å¦‚ä»æœ‰é—®é¢˜ï¼Œå¯ä¿®æ”¹è„šæœ¬ç¬¬ 39 è¡Œ:
      SPARK_DRIVER_MEMORY = "6g"
    - æˆ–ä½¿ç”¨ Colab Pro (æ›´å¤š RAM)

é—®é¢˜ 3: Java æœªå®‰è£…æˆ–ç‰ˆæœ¬ä¸åŒ¹é…
  åŸå› : ç¯å¢ƒé…ç½®å¤±è´¥
  è§£å†³: 
    - è„šæœ¬ä¼šè‡ªåŠ¨å®‰è£… Java 11
    - å¦‚å¤±è´¥ï¼Œé‡å¯ Colab runtime åé‡æ–°è¿è¡Œ
    - æˆ–æ‰‹åŠ¨è¿è¡Œç¯å¢ƒè®¾ç½®éƒ¨åˆ†

é—®é¢˜ 4: PySpark å¯¼å…¥é”™è¯¯
  åŸå› : PySpark æœªæ­£ç¡®å®‰è£…
  è§£å†³:
    - è„šæœ¬ä¼šè‡ªåŠ¨å®‰è£… PySpark
    - å¦‚å¤±è´¥ï¼Œæ‰‹åŠ¨è¿è¡Œ: !pip install pyspark
    - éªŒè¯: import pyspark; print(pyspark.__version__)

é—®é¢˜ 5: æ‰§è¡Œæ—¶é—´è¿‡é•¿
  è¯´æ˜: 
    - å®Œæ•´æµç¨‹éœ€è¦ 15-25 åˆ†é’Ÿæ˜¯æ­£å¸¸çš„
    - æ•°æ®é›†æœ‰ 6.36M è¡Œï¼Œå¤„ç†éœ€è¦æ—¶é—´
    - Colab å…è´¹ç‰ˆ CPU è¾ƒæ…¢ï¼Œè¯·è€å¿ƒç­‰å¾…
    - å¯ä»¥çœ‹åˆ°æ¯ä¸ªæ­¥éª¤çš„è¿›åº¦æç¤º

=============================================================================
æŠ€æœ¯ç»†èŠ‚
=============================================================================

æ•°æ®é›†: PaySim Synthetic Financial Dataset
  - æ¥æº: Kaggle
  - è§„æ¨¡: 6,362,620 æ¡äº¤æ˜“è®°å½•
  - ç‰¹å¾: 11 ä¸ªå­—æ®µ
  - æ ‡ç­¾: isFraud (0/1)
  - ç±»åˆ«ä¸å¹³è¡¡: æ¬ºè¯ˆç‡ 0.13%

ç®—æ³•: Logistic Regression (ä¸ Iteration 3 ä¿æŒä¸€è‡´)
  - ä¸å¹³è¡¡å¤„ç†: ç±»åˆ«åŠ æƒ (weightCol)
  - æ­£åˆ™åŒ–: L2 (regParam=0.01)
  - Pipeline: VectorAssembler â†’ StandardScaler â†’ LR

é˜ˆå€¼ä¼˜åŒ–:
  - æˆæœ¬æ¯”ä¾‹: FP:FN = 1:25 (ä¸šåŠ¡é©±åŠ¨)
  - ä¼˜åŒ–é›†: éªŒè¯é›† (ç‹¬ç«‹äºè®­ç»ƒå’Œæµ‹è¯•)
  - æ‰«æèŒƒå›´: Ï„ âˆˆ [0.01, 0.99]ï¼Œæ­¥é•¿ 0.01
  - æœ€ä¼˜é˜ˆå€¼: Ï„* = 0.72

=============================================================================
ç³»ç»Ÿè¦æ±‚
=============================================================================

Google Colab ç¯å¢ƒ:
  âœ“ Python 3.10+
  âœ“ 12GB RAM (å…è´¹ç‰ˆ)
  âœ“ ç½‘ç»œè¿æ¥ (ç”¨äºå®‰è£…ä¾èµ–å’Œä¸Šä¼ æ•°æ®)

è‡ªåŠ¨å®‰è£…çš„ä¾èµ–:
  âœ“ OpenJDK 11
  âœ“ PySpark 3.4+

=============================================================================
é¡¹ç›®ç»“æ„
=============================================================================

å®Œæ•´é¡¹ç›®åŒ…å«ä»¥ä¸‹æ–‡ä»¶ (æœ¬æäº¤ä»…åŒ…å« Colab è¿è¡Œæ‰€éœ€æ–‡ä»¶):

æ ¸å¿ƒæ–‡ä»¶ (å·²åŒ…å«):
  âœ“ fraud_detection_colab.py     Colab é€‚é…è„šæœ¬
  âœ“ Financial Fraud-Rawdata.csv  PaySim æ•°æ®é›†
  âœ“ README_COLAB.txt             æœ¬è¯´æ˜æ–‡ä»¶

å…¶ä»–æ–‡ä»¶ (åœ¨å®Œæ•´é¡¹ç›®ä¸­):
  - fraud_detection_final.py     æœ¬åœ°è¿è¡Œç‰ˆæœ¬
  - plot_results.py              ç»“æœå¯è§†åŒ–è„šæœ¬
  - 722-assignment04.tex         LaTeX æŠ¥å‘Šæºæ–‡ä»¶
  - 722-assignment04.pdf         æœ€ç»ˆæŠ¥å‘Š PDF
  - Figure/                      æŠ¥å‘Šå›¾è¡¨ç›®å½•

=============================================================================
å¼•ç”¨ä¸è‡´è°¢
=============================================================================

æ•°æ®é›†:
  PaySim: Synthetic Financial Dataset for Fraud Detection
  Kaggle: https://www.kaggle.com/datasets/ealaxi/paysim1

æŠ€æœ¯æ¡†æ¶:
  - Apache Spark: https://spark.apache.org/
  - PySpark MLlib: https://spark.apache.org/docs/latest/ml-guide.html

è¯¾ç¨‹:
  INFOSYS 722 - Big Data Analytics Solutions
  University of Auckland, 2025 Semester 2

=============================================================================
è”ç³»æ–¹å¼
=============================================================================

å¦‚æœ‰ä»»ä½•é—®é¢˜æˆ–éœ€è¦æ¾„æ¸…ï¼Œè¯·è”ç³»:

  å­¦ç”Ÿ: Xiaoqing Miao
  é‚®ç®±: xmia665@aucklanduni.ac.nz
  æœºæ„: University of Auckland
  è¯¾ç¨‹: INFOSYS 722

=============================================================================
å­¦æœ¯è¯šä¿¡å£°æ˜
=============================================================================

æœ¬é¡¹ç›®ä¸ºåŸåˆ›å­¦æœ¯ä½œä¸šï¼Œéµå¾ªå¥¥å…‹å…°å¤§å­¦å­¦æœ¯è¯šä¿¡æ”¿ç­–ã€‚
æ‰€æœ‰ä»£ç ã€åˆ†æå’Œç»“è®ºå‡ä¸ºæœ¬äººç‹¬ç«‹å®Œæˆã€‚
æ•°æ®ä½¿ç”¨å·²è·å¾—é€‚å½“æˆæƒã€‚

å‚è€ƒ: https://www.auckland.ac.nz/en/students/forms-policies-and-guidelines/student-policies-and-guidelines/academic-integrity-copyright.html

=============================================================================
æœ€åæ›´æ–°: 2025-10-15
ç‰ˆæœ¬: Iteration 4 (BDAS - Google Colab)
=============================================================================

